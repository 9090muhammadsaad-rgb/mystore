<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --ps-green: #01875f;
            --ps-dark: #202124;
            --ps-grey: #5f6368;
            --ps-bg: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Google Sans', sans-serif; }
        body { background: var(--ps-bg); color: var(--ps-dark); }

        /* Header Fix */
        header {
            position: sticky; top: 0; z-index: 1000;
            background: #fff; padding: 12px 20px;
            border-bottom: 1px solid #e8eaed;
        }

        .search-container { max-width: 650px; margin: 0 auto; position: relative; }
        
        .search-box {
            width: 100%; padding: 12px 20px 12px 45px;
            background: #f1f3f4; border: 1px solid transparent; border-radius: 8px;
            font-size: 16px; outline: none;
        }

        .search-box:focus { background: #fff; border-color: #e8eaed; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }

        /* Suggestions UI Fix */
        #suggestions {
            position: absolute; top: 105%; left: 0; width: 100%;
            background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none; overflow: hidden; z-index: 3000;
        }

        .sugg-item {
            padding: 12px 20px; cursor: pointer; display: flex; align-items: center; border-bottom: 1px solid #f1f3f4;
        }
        .sugg-item:hover { background: #f8f9fa; color: var(--ps-green); }

        /* App Cards Layout */
        .container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px; margin-top: 15px;
        }

        .app-card { cursor: pointer; text-align: left; transition: 0.2s; padding: 10px; border-radius: 12px; }
        .app-card:hover { background: #f1f3f4; }
        
        .app-card img {
            width: 100%; aspect-ratio: 1/1; border-radius: 22%;
            object-fit: cover; margin-bottom: 8px; border: 1px solid #e8eaed;
        }

        .app-name { font-size: 14px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .app-cat { font-size: 12px; color: var(--ps-grey); }

        /* App Modal (Full Screen Detail) */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 4000; display: none; overflow-y: auto;
        }

        .modal-content { max-width: 800px; margin: 0 auto; padding: 20px; position: relative; }
        .close-btn { font-size: 28px; cursor: pointer; border: none; background: none; margin-bottom: 20px; }

        .app-main-info { display: flex; gap: 20px; margin-bottom: 30px; }
        .app-main-info img { width: 120px; height: 120px; border-radius: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        .btn-install {
            background: var(--ps-green); color: white; border: none;
            padding: 12px 45px; border-radius: 8px; font-weight: 500;
            cursor: pointer; margin-top: 15px; width: 100%; max-width: 250px;
        }

        .details-section { border-top: 1px solid #e8eaed; padding-top: 20px; margin-top: 20px; }
        .section-title { font-size: 18px; font-weight: 500; margin-bottom: 15px; }
        
        .platform-badge { background: #e8f0fe; color: #1967d2; padding: 4px 12px; border-radius: 4px; font-size: 12px; margin-right: 5px; }
    </style>
</head>
<body>

    <header>
        <div class="search-container">
            <input type="text" id="search-input" class="search-box" placeholder="Search apps & games..." autocomplete="off">
            <div id="suggestions"></div>
        </div>
    </header>

    <div class="container">
        <h2 id="view-title">Recommended for you</h2>
        <div class="grid" id="app-grid"></div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeApp()">‚Üê</button>
            <div id="app-details-render"></div>
            
            <div class="details-section">
                <div class="section-title">Similar Items</div>
                <div class="grid" id="similar-grid"></div>
            </div>
        </div>
    </div>

    <script>
        let allApps = [];
        let searchKeys = [];

        async function startStore() {
            try {
                const resApps = await fetch('info.json?v=' + Date.now());
                const resSearch = await fetch('search.txt?v=' + Date.now());
                
                allApps = await resApps.json();
                const searchText = await resSearch.text();
                searchKeys = searchText.split('\n').filter(k => k.trim());
                
                renderGrid(allApps);
            } catch (e) {
                console.error("Data load fail.");
            }
        }

        function renderGrid(data) {
            const grid = document.getElementById('app-grid');
            grid.innerHTML = data.map(app => `
                <div class="app-card" onclick="openApp(${app.id})">
                    <img src="${app.icon === 'N/A' ? 'https://via.placeholder.com/150' : app.icon}">
                    <div class="app-name">${app.name}</div>
                    <div class="app-cat">${app.category}</div>
                </div>
            `).join('');
        }

        // --- FIXED SEARCH LOGIC ---
        const input = document.getElementById('search-input');
        const suggs = document.getElementById('suggestions');

        input.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            if(val.length > 0) {
                // Show matching keywords from search.txt
                const matches = searchKeys.filter(k => k.toLowerCase().includes(val)).slice(0, 6);
                if(matches.length > 0) {
                    suggs.innerHTML = matches.map(m => `<div class="sugg-item" onclick="executeSearch('${m}')">üîç ${m}</div>`).join('');
                    suggs.style.display = 'block';
                } else { suggs.style.display = 'none'; }
            } else {
                suggs.style.display = 'none';
                renderGrid(allApps); // Show all apps if search is empty
            }
        });

        function executeSearch(keyword) {
            input.value = keyword;
            suggs.style.display = 'none';
            document.getElementById('view-title').innerText = `Results for "${keyword}"`;
            
            // Search in both Name and Category
            const results = allApps.filter(a => 
                a.name.toLowerCase().includes(keyword.toLowerCase()) || 
                a.category.toLowerCase().includes(keyword.toLowerCase())
            );
            renderGrid(results);
        }

        // --- APP DETAILS ---
        function openApp(id) {
            const app = allApps.find(a => a.id === id);
            const detailBox = document.getElementById('app-details-render');
            
            detailBox.innerHTML = `
                <div class="app-main-info">
                    <img src="${app.icon}">
                    <div>
                        <h1 style="font-size:24px;">${app.name}</h1>
                        <p style="color:var(--ps-green); font-weight:500;">${app.owner}</p>
                        <button class="btn-install" onclick="window.open('${app.versions[0].download}')">
                            ${app.available ? 'Install' : 'Coming Soon'}
                        </button>
                    </div>
                </div>
                <div class="details-section">
                    <div class="section-title">About this game</div>
                    <p style="color:var(--ps-grey); line-height:1.6;">${app.description}</p>
                    <div style="margin-top:15px;">
                        <span class="platform-badge">Windows</span>
                        <span class="platform-badge">macOS</span>
                        <span class="platform-badge">Linux</span>
                    </div>
                </div>
                <div class="details-section">
                    <div class="section-title">Data Safety</div>
                    <div style="background:#f8f9fa; padding:15px; border-radius:8px; font-size:13px;">
                        Safety starts with understanding how developers collect and share your data.
                    </div>
                </div>
            `;

            // Similar Items
            const similar = allApps.filter(a => app.recommended.includes(a.id));
            const simGrid = document.getElementById('similar-grid');
            simGrid.innerHTML = similar.map(s => `
                <div class="app-card" onclick="openApp(${s.id})">
                    <img src="${s.icon}" style="width:80px; height:80px;">
                    <div class="app-name" style="font-size:11px;">${s.name}</div>
                </div>
            `).join('');

            document.getElementById('modal').style.display = 'block';
            window.scrollTo(0,0);
        }

        function closeApp() { document.getElementById('modal').style.display = 'none'; }

        startStore();
    </script>
</body>
</html>
